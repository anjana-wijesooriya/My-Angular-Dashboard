!function(e,t,r){"use strict";function a(e){var t=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!t||4!==t.length)throw new Error("Invalid state ref '"+e+"'");return{state:t[1],paramExpr:t[3]||null}}var n={};function c(e,t,a,c){var u=n[e];u!==r&&u(),u=t.$on(a,c),n[e]=u}var u=function(e){if(e.expressions)return e.expressions;var r=[];return t.forEach(e.parts,function(e){t.isFunction(e)&&r.push(e.exp)}),r},i=function(e,r,a,n){t.forEach(u(r),function(t){var c=a.$watch(t,function(){n.ncyBreadcrumbLabel=r(a)});e.push(c)})},o=function(e){t.forEach(e,function(e){e()})};function s(e,r,a){return{restrict:"AE",replace:!0,scope:{},template:r.getTemplate({bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'}),templateUrl:r.getTemplateUrl(),link:{post:function(n){var u=[],s=function(){o(u),u=[];var a=r.$getLastViewScope();n.steps=r.getStatesChain(),t.forEach(n.steps,function(t){if(t.ncyBreadcrumb&&t.ncyBreadcrumb.label){var r=e(t.ncyBreadcrumb.label);t.ncyBreadcrumbLabel=r(a),i(u,r,a,t)}else t.ncyBreadcrumbLabel=t.name})};c("BreadcrumbDirective.$viewContentLoaded",a,"$viewContentLoaded",function(e){e.targetScope.ncyBreadcrumbIgnore||s()}),s()}}}}function l(e,t,r){return{restrict:"A",scope:{},template:t.getTemplateLast({default:"{{ncyBreadcrumbLabel}}"}),templateUrl:t.getTemplateLastUrl(),compile:function(a,n){var u=a.attr(n.$attr.ncyBreadcrumbLast);return u&&a.html(u),{post:function(a){var n=[],u=function(){o(n),n=[];var r=t.$getLastViewScope(),c=t.getLastStep();if(c)if(a.ncyBreadcrumbLink=c.ncyBreadcrumbLink,c.ncyBreadcrumb&&c.ncyBreadcrumb.label){var u=e(c.ncyBreadcrumb.label);a.ncyBreadcrumbLabel=u(r),i(n,u,r,a)}else a.ncyBreadcrumbLabel=c.name};c("BreadcrumbLastDirective.$viewContentLoaded",r,"$viewContentLoaded",function(e){e.targetScope.ncyBreadcrumbIgnore||u()}),u()}}}}}function p(e,r,a){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(n,i){var s=n.attr(i.$attr.ncyBreadcrumbText);s&&n.html(s);var l=n.attr(i.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function(n){var i=[],s=function(){o(i),i=[];var a=r.$getLastViewScope(),c=r.getStatesChain(),p=[];t.forEach(c,function(r){if(r.ncyBreadcrumb&&r.ncyBreadcrumb.label){var n=e(r.ncyBreadcrumb.label);p.push(n(a)),c=i,o=n,l=a,t.forEach(u(o),function(e){var t=l.$watch(e,function(e,t){e!==t&&s()});c.push(t)})}else p.push(r.name);var c,o,l}),n.ncyBreadcrumbChain=p.join(l)};c("BreadcrumbTextDirective.$viewContentLoaded",a,"$viewContentLoaded",function(e){e.targetScope.ncyBreadcrumbIgnore||s()}),s()}}}}}s.$inject=["$interpolate","$breadcrumb","$rootScope"],l.$inject=["$interpolate","$breadcrumb","$rootScope"],p.$inject=["$interpolate","$breadcrumb","$rootScope"],t.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",function(){var e={prefixStateName:null,template:"bootstrap3",templateUrl:null,templateLast:"default",templateLastUrl:null,includeAbstract:!1};this.setOptions=function(r){t.extend(e,r)},this.$get=["$state","$stateParams","$rootScope",function(n,u,i){var o=i;c("$Breadcrumb.$viewContentLoaded",i,"$viewContentLoaded",function(e){var r,a;!e.targetScope.ncyBreadcrumbIgnore&&(r=e.targetScope.$id,a=o.$id,t.equals(r.length,a.length)?r>a:r.length>a.length)&&(o=e.targetScope)});var s=function(t,r){for(var c,i,s=a(r),l=!1,p=!1,m=0,d=t.length;m<d;m+=1)if(t[m].name===s.state)return;(c=n.get(s.state)).ncyBreadcrumb&&(c.ncyBreadcrumb.force&&(l=!0),c.ncyBreadcrumb.skip&&(p=!0)),c.abstract&&!e.includeAbstract&&!l||p||(s.paramExpr&&(i=o.$eval(s.paramExpr)),c.ncyBreadcrumbLink=n.href(s.state,i||u||{}),c.ncyBreadcrumbStateRef=r,t.unshift(c))},l=function(e){var t,r,c=a(e),u=n.get(c.state);if(u.ncyBreadcrumb&&u.ncyBreadcrumb.parent){var i="function"==typeof u.ncyBreadcrumb.parent?u.ncyBreadcrumb.parent(o):u.ncyBreadcrumb.parent;if(i)return i}return"object"==typeof(r=(t=u).parent||(/^(.+)\.[^.]+$/.exec(t.name)||[])[1])?r.name:r};return{getTemplate:function(t){return e.templateUrl?null:t[e.template]?t[e.template]:e.template},getTemplateUrl:function(){return e.templateUrl},getTemplateLast:function(t){return e.templateLastUrl?null:t[e.templateLast]?t[e.templateLast]:e.templateLast},getTemplateLastUrl:function(){return e.templateLastUrl},getStatesChain:function(t){for(var r=[],a=n.$current.self.name;a;a=l(a))if(s(r,a),t&&r.length)return r;return e.prefixStateName&&s(r,e.prefixStateName),r},getLastStep:function(){var e=this.getStatesChain(!0);return e.length?e[0]:r},$getLastViewScope:function(){return o}}}]}).directive("ncyBreadcrumb",s).directive("ncyBreadcrumbLast",l).directive("ncyBreadcrumbText",p)}(window,window.angular);